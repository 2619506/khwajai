<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Khwaja AI | Intelligent Analytics</title>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;700&family=Outfit:wght@300;400;600&display=swap');

  :root{
    /* --- THEME: STARLIGHT & ROCK --- */
    --neon: #e2e8f0;               /* Starlight White/Silver */
    --neon-soft: rgba(226, 232, 240, 0.5); /* Soft White Glow */
    --rock-dark: #0f172a;          /* Deep Slate Shadow */
    --rock-light: #64748b;         /* Lighter Stone Highlight */
    --glass: rgba(15, 23, 42, 0.6); 
    --ink: #cbd5e1;                /* Soft Grey Text */
  }

  * { box-sizing:border-box; }
  html, body { height:100%; }
  body {
    margin: 0; overflow: hidden; background: #020617; /* Deepest Cosmic Blue */
    color: var(--neon);
    font-family: 'Outfit', sans-serif; /* Cleaner font for reading */
    letter-spacing: 0.5px;
  }

  /* Starfield */
  canvas#stars { position:fixed; inset:0; z-index:-3; }

  /* --- MAIN ASTEROID / GLOBE --- */
  .wheel {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) rotate(0deg);
    width: min(80vw, 550px); height: min(80vw, 550px); border-radius: 50%;
    
    /* 3D Rocky Gradient */
    background: radial-gradient(circle at 30% 30%, var(--rock-light) 0%, var(--rock-dark) 50%, #000000 100%);
    
    /* Atmosphere/Rim Light */
    box-shadow: 
      inset 0 0 100px rgba(0,0,0,0.9), 
      0 0 50px rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 1;
  }

  /* --- ORBITING MINI-PLANETS (Tabs) --- */
  .tab {
    position: absolute;
    width: 90px;  /* Fixed Equal Size */
    height: 90px; /* Fixed Equal Size */
    border-radius: 50%; /* Perfect Circle */
    
    /* Mini Planet Gradient (Matches Main Globe) */
    background: radial-gradient(circle at 30% 30%, #94a3b8 0%, #1e293b 60%, #000 100%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    
    /* Text Styling */
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1px;
    font-weight: 700;
    text-transform: uppercase;
    
    /* Centering Text */
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    
    cursor: pointer;
    box-shadow: 0 0 15px rgba(0,0,0,0.8), inset 0 0 10px rgba(255,255,255,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s;
    user-select: none;
    z-index: 2;
  }

  .tab:hover {
    transform: scale(1.15) translateX(-50%); /* Pop effect */
    border-color: #fff;
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.2), inset 0 0 15px rgba(255,255,255,0.2);
  }

  /* Tab Positions (Adjusted for circles) */
  .tab1 { top: -12%; left: 50%; transform: translateX(-50%); }
  .tab2 { top: 50%; right: -12%; transform: translateY(-50%); }
  .tab3 { bottom: -12%; left: 50%; transform: translateX(-50%); }
  .tab4 { top: 50%; left: -12%; transform: translateY(-50%); }
  /* Portfolio (Tab 5) positioned between bottom and left */
  .tab5 { bottom: 8%; left: 8%; transform: translate(0, 0); } 

  /* --- CENTER CONTENT (The "Abstract") --- */
  .center-content {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
    width: 75%; /* Narrower width helps round the text shape */
    height: 75%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    pointer-events: none;
    text-align: center;
  }

  /* Catchy Title */
  #ccTitle {
    margin: 0 0 15px 0;
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(2rem, 4vw, 3rem); /* Much Bigger */
    font-weight: 700;
    letter-spacing: 2px;
    
    /* Metallic Text Gradient */
    background: linear-gradient(180deg, #ffffff 0%, #94a3b8 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
  }

  /* The "Round" Text Paragraph */
  #ccText {
    color: #e2e8f0;
    font-size: clamp(0.85rem, 1.2vh, 1rem);
    line-height: 1.6;
    font-weight: 300;
    
    /* Shaping text */
    text-wrap: balance; /* Modern CSS to balance lines */
    max-width: 400px;
    margin: 0 auto;
    
    /* Slight shadow for readability against rock background */
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
  }
  
  #ccText b {
    color: #fff;
    font-weight: 600;
    display: block; /* Force new line for the bold subtitle */
    margin-bottom: 8px;
    font-size: 1.1em;
    letter-spacing: 1px;
  }

  /* Assistant Dock */
  .assistant-wrap {
    position: fixed; left: 14px; bottom: 15px; width: 58px; height: 58px;
    z-index: 9998; pointer-events: none;
  }
  .assistant-wrap::before {
    content: ""; position: absolute; inset: 0; border-radius: 50%;
    background: radial-gradient(circle at center, rgba(255,255,255,0.9) 0%, rgba(139, 169, 219, 0.4) 40%, transparent 100%);
    box-shadow: 0 0 18px rgba(255,255,255,0.4);
    filter: blur(2px);
    animation: assistantGlow 4s ease-in-out infinite alternate;
    z-index: -1; pointer-events: none;
  }
  @keyframes assistantGlow { from { opacity: 0.65; transform: scale(0.95); } to { opacity: 1; transform: scale(1.05); } }

  /* OVERLAY STYLES (Unchanged logic, just theme updates) */
  .overlay { position: fixed; inset: 0; display: none; place-items: center; z-index: 5; background: radial-gradient(ellipse at center, rgba(15, 23, 42, 0.4) 0%, rgba(2, 6, 23, 0.9) 80%); animation: fadeIn 300ms ease-out; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .panel { width: min(1200px, 92vw); height: min(78vh, 820px); border: 1px solid var(--neon-soft); background: linear-gradient(180deg, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.95)); border-radius: 24px; box-shadow: 0 0 60px rgba(0,0,0,0.5); backdrop-filter: blur(12px); position: relative; overflow: hidden; }
  .panel-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); }
  .close-btn { width: 36px; height: 36px; border-radius: 50%; border: 1px solid #fff; background: transparent; color: #fff; cursor: pointer; display: grid; place-items: center; }
  .panel-body { display: grid; grid-template-columns: 320px 1fr; gap: 16px; height: calc(100% - 62px); padding: 16px; }
  .controls { overflow-y: auto; } .chart-wrap { position: relative; height: 100%; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 8px; background: rgba(0,0,0,0.3); }
  .card { border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 12px; margin-bottom: 12px; background: rgba(255,255,255,0.03); }
  input, select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.5); color: #fff; }
  .btn { cursor: pointer; font-weight: bold; text-transform: uppercase; } .btn:hover { background: rgba(255,255,255,0.1); }
  #sphereWrap { position: absolute; inset: 8px; border-radius: 12px; overflow: hidden; z-index: 0; pointer-events: none; }
  canvas#sphere { width: 100%; height: 100%; display: block; filter: drop-shadow(0 0 10px var(--neon-soft)); opacity: 0.6; }
  .insights { position: absolute; left: 16px; right: 16px; bottom: 16px; z-index: 2; background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 10px; color: var(--ink); font-size: 0.85rem; }
  
  @media (max-width: 980px){ .panel-body { grid-template-columns: 1fr; height: auto; } .chart-wrap { height: 50vh; } #sphereWrap { display: none; } }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<div class="wheel" id="wheel">
  
  <div class="tab tab1" onclick="showHome()">Analytics</div>
  <div class="tab tab2" onclick="showMessage('Finance panel docking...')">Finance</div>
  <div class="tab tab3" onclick="showMessage('AI & ML bay online...')">AI & ML</div>
  <div class="tab tab4" onclick="openOverlay()">Tools</div>
  <div class="tab tab5" onclick="window.open('/portfolio/', '_blank')">Portfolio</div>

  <div class="center-content" id="centerContent">
    <h1 id="ccTitle">KHWAJA AI</h1>
    <p id="ccText">
      <b>Business Intelligence & Operations Strategist</b>
      Merging an MSc in Business Analytics & Finance with over 5 years of operational expertise. From streamlining diplomatic workflows to driving data-led strategies in retail, I bridge the gap between technical insights and executive decision-making. I specialize in optimizing processes, financial modeling, and delivering actionable intelligence using Python, SQL, and Power BI.
    </p>
  </div>
</div>

<div class="assistant-wrap">
  <div class="assistant-hole"></div>
</div>

<div id="analyzerOverlay" class="overlay" aria-hidden="true">
  <div class="panel" role="dialog">
    <div class="panel-header">
      <div style="display:flex;align-items:center;gap:10px"><span>ðŸ›¸</span><span style="font-weight:bold;letter-spacing:1px">Khwaja AI Analyzer</span></div>
      <button class="close-btn" onclick="closeOverlay()">âœ•</button>
    </div>
    <div class="panel-body">
      <div class="controls">
        <div class="card">
          <h3>1. Data Upload</h3>
          <label>Dataset 1 (CSV/Excel)</label><input id="file1" type="file" accept=".csv,.xlsx,.xls" />
          <label>Dataset 2 (CSV/Excel)</label><input id="file2" type="file" accept=".csv,.xlsx,.xls" />
        </div>
        <div class="card">
          <h3>2. Configuration</h3>
          <label>X-Axis</label> <select id="x1" disabled></select>
          <label>Y-Axis</label> <select id="y1" disabled></select>
          <label>Chart Type</label>
          <select id="chartType" disabled>
            <option value="scatter">Scatter</option><option value="line">Line</option><option value="bar">Bar</option>
            <option value="area">Area</option><option value="pie">Pie</option><option value="heatmap">Heatmap</option>
          </select>
        </div>
        <div class="card">
          <h3>3. Action</h3>
          <button id="vizBtn" class="btn" onclick="plotData()" disabled>Visualize Data</button>
        </div>
        <div class="card">Status: <span id="status">Waiting for files...</span></div>
      </div>
      <div class="chart-wrap">
        <div id="sphereWrap"><canvas id="sphere"></canvas></div>
        <div id="chart"></div>
        <div id="insights" class="insights" style="display:none;"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  if(!window.chatbase || window.chatbase("getState")!=="initialized"){
    window.chatbase=(...arguments)=>{ if(!window.chatbase.q){window.chatbase.q=[]} window.chatbase.q.push(arguments) };
    window.chatbase=new Proxy(window.chatbase,{ get(target,prop){ if(prop==="q"){return target.q} return(...args)=>target(prop,...args) } });
  }
  const onLoad=function(){
    const script=document.createElement("script");
    script.src="https://www.chatbase.co/embed.min.js";
    script.id="85-fKKKuG65obFx8ejTz3";
    script.domain="www.chatbase.co";
    document.body.appendChild(script);
  };
  if(document.readyState==="complete"){onLoad()} else { window.addEventListener("load", onLoad) }
})();
/* Move Chatbase to Dock */
window.addEventListener("load", function(){
  setTimeout(()=>{
    const bubble = document.querySelector("#chatbase-bubble, iframe[src*='chatbase']");
    if(bubble){
      bubble.style.position = "absolute"; bubble.style.bottom = "50%"; bubble.style.left = "50%";
      bubble.style.transform = "translate(-50%, 50%) scale(0.9)"; bubble.style.zIndex = "12";
      document.querySelector(".assistant-wrap").appendChild(bubble);
    }
  }, 2500);
});
</script>

<script>
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [], meteors = [];
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); addEventListener('resize', resizeCanvas);
function createStars(count){ stars=[]; for(let i=0;i<count;i++){ stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, speed:Math.random()*0.2+0.05, size:Math.random()*1.5 }); } }
function createMeteors(count){ meteors=[]; for(let i=0;i<count;i++){ meteors.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, speedX:-(Math.random()*4+2), speedY:Math.random()*2+1, length:Math.random()*50+30 }); } }
function drawStars(){ 
  ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#ffffff'; 
  for(const s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill(); s.y+=s.speed; if(s.y>canvas.height){s.y=0;s.x=Math.random()*canvas.width;} } 
  ctx.strokeStyle = '#ffffff'; ctx.lineWidth=0.8;
  for(const m of meteors){ ctx.beginPath(); ctx.moveTo(m.x,m.y); ctx.lineTo(m.x+m.length*m.speedX/10, m.y+m.length*m.speedY/10); ctx.stroke(); m.x+=m.speedX; m.y+=m.speedY; if(m.x<-100||m.y>canvas.height+100){m.x=canvas.width+Math.random()*200;m.y=Math.random()*canvas.height/2;} } 
}
createStars(300); createMeteors(3);
(function animate(){ drawStars(); requestAnimationFrame(animate); })();

/* Wheel Rotation */
const wheel = document.getElementById('wheel');
document.addEventListener('mousemove', e=>{ 
  const centerX = innerWidth/2; const offsetX = e.clientX - centerX; 
  const rotation = offsetX/40; 
  wheel.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`; 
});

/* Home & UI Logic */
function showHome(){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `<h1 id="ccTitle">KHWAJA AI</h1><p id="ccText"><b>Business Intelligence & Operations Strategist</b>Merging an MSc in Business Analytics & Finance with over 5 years of operational expertise. From streamlining diplomatic workflows to driving data-led strategies in retail, I bridge the gap between technical insights and executive decision-making. I specialize in optimizing processes, financial modeling, and delivering actionable intelligence using Python, SQL, and Power BI.</p>`;
}
function showMessage(msg){ 
  const cc = document.getElementById('centerContent'); 
  cc.innerHTML = `<h1 id="ccTitle" style="font-size:2rem">SYSTEM</h1><p id="ccText" style="font-size:1.2rem">${msg}</p>`; 
}
function openOverlay(){ document.getElementById('analyzerOverlay').style.display = 'grid'; startSphere(); onResizeSphere(); }
function closeOverlay(){ document.getElementById('analyzerOverlay').style.display = 'none'; stopSphere(); }

/* Chart/File Logic (Simplified for brevity) */
let dataset1 = [], dataset2 = [];
const el = id => document.getElementById(id);
const setStatus = msg => el('status').textContent = msg;
function setControlsEnabled(enabled){ ['x1','y1','chartType','vizBtn'].forEach(id=>{ if(el(id)) el(id).disabled=!enabled; }); }
el('file1').addEventListener('change', e=> loadFile(e.target.files[0], 1));
el('file2').addEventListener('change', e=> loadFile(e.target.files[0], 2));
function loadFile(file, idx){ 
  if(!file) return; 
  setStatus(`Loading ${file.name}...`);
  if(file.name.endsWith('.csv')){ Papa.parse(file, {header:true, dynamicTyping:true, complete: res => assignData(res.data, idx)}); }
  else { setStatus("Excel parsing requires server or fuller library setup."); } // Placeholder for brevity
}
function assignData(data, idx){ 
  const clean = data.filter(r => Object.values(r).some(v=>v!==null));
  if(idx===1) dataset1=clean; else dataset2=clean;
  setStatus(`Loaded dataset ${idx} (${clean.length} rows)`);
  if(dataset1.length || dataset2.length) { populateDropdowns(); setControlsEnabled(true); }
}
function populateDropdowns(){
  const keys = Object.keys(dataset1[0] || dataset2[0] || {});
  ['x1','y1'].forEach(id => { el(id).innerHTML = keys.map(k=>`<option>${k}</option>`).join(''); });
}
function plotData(){
  const xKey = el('x1').value, yKey = el('y1').value, type = el('chartType').value;
  const trace1 = { x: dataset1.map(r=>r[xKey]), y: dataset1.map(r=>r[yKey]), type: type==='scatter'?'scatter':type, mode:'markers' };
  Plotly.newPlot('chart', [trace1], { paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)', font:{color:'#fff'} });
}

/* 3D Sphere Logic */
let sphereScene, sphereCamera, sphereRenderer, sphereMesh, sphereReq;
function startSphere(){
  const wrap = document.getElementById('sphereWrap');
  const canvas = document.getElementById('sphere');
  sphereScene = new THREE.Scene();
  const w = wrap.clientWidth, h = wrap.clientHeight;
  sphereCamera = new THREE.PerspectiveCamera(35, w/h, 0.1, 1000); sphereCamera.position.z = 6;
  sphereRenderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
  sphereRenderer.setSize(w,h,false);
  const geo = new THREE.SphereGeometry(2.2, 48, 48);
  const mat = new THREE.MeshPhongMaterial({ color: 0x94a3b8, emissive: 0x0f172a, shininess: 30, transparent:true, opacity:0.6, wireframe:true });
  sphereMesh = new THREE.Mesh(geo, mat); sphereScene.add(sphereMesh);
  const glow = new THREE.PointLight(0xffffff, 1, 50); glow.position.set(4,4,6); sphereScene.add(glow);
  const animate = ()=>{ sphereMesh.rotation.y += 0.0025; sphereRenderer.render(sphereScene, sphereCamera); sphereReq = requestAnimationFrame(animate); };
  animate();
}
function stopSphere(){ if(sphereReq) cancelAnimationFrame(sphereReq); }
function onResizeSphere(){ if(sphereRenderer) { const w = el('sphereWrap').clientWidth, h = el('sphereWrap').clientHeight; sphereRenderer.setSize(w,h,false); sphereCamera.aspect=w/h; sphereCamera.updateProjectionMatrix(); } }
addEventListener('resize', onResizeSphere);
</script>

</body>
</html>
