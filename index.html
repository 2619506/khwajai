<!-- Chat Widget -->
<div id="chat-widget">
  <div id="chat-header">üí¨ AI Assistant</div>
  <div id="chat-body" style="display: none;">
    <div id="chat-box"></div>
    <div id="chat-input">
      <input type="text" id="userMessage" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<style>
  /* ... existing styles ... */

  #chat-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  #chat-header {
    background: #444;
    color: white;
    padding: 10px;
    cursor: pointer;
    font-weight: bold;
  }
  #chat-box {
    height: 250px;
    overflow-y: auto;
    padding: 10px;
    background: #fafafa;
    flex: 1;
  }
</style>

<script>
  const chatBody = document.getElementById('chat-body');
  const chatHeader = document.getElementById('chat-header');
  const chatBox = document.getElementById('chat-box');
  const userInput = document.getElementById('userMessage');

  // Toggle open/close body
  chatHeader.addEventListener('click', () => {
    chatBody.style.display = chatBody.style.display === 'none' ? 'flex' : 'none';
    chatBody.style.flexDirection = 'column';
  });

  // Send on Enter
  userInput?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });

  async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;

    addMessage(message, 'user');
    userInput.value = '';

    try {
      const res = await fetch('/.netlify/functions/chatgpt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });

      const data = await res.json();
      if (data.reply) {
        addMessage(data.reply, 'ai');
      } else {
        addMessage(`‚ùå Error: ${JSON.stringify(data)}`, 'ai');
      }
    } catch (err) {
      addMessage(`‚ùå Error: ${err.message}`, 'ai');
    }
  }

  function addMessage(text, sender) {
    const div = document.createElement('div');
    div.className = `msg ${sender}`;
    div.textContent = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
