<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Khwaja AI</title>

<!-- Plotly + CSV/XLSX parsing -->
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Three.js for the Moon -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  :root{
    --neon:#00ffcc;          /* MAIN NEON CYAN COLOR */
    --neon-soft:rgba(0,255,204,0.6);
    --glass:rgba(0,10,10,0.55);
    --glass-strong:rgba(0,20,20,0.75);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; overflow:hidden; background:black; color:var(--neon);
    font-family:'Share Tech Mono', monospace; letter-spacing:0.6px;
  }

  /* Starfield background */
  canvas#stars{position:fixed; inset:0; z-index:-2}

  /* Global glow feel */
  h1,h2,h3,p,a,label,button,select,input{
    text-shadow:0 0 8px var(--neon), 0 0 20px var(--neon-soft);
  }

  /* Spaceship Wheel */
  .wheel{
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%) rotate(0deg);
    width:460px; height:460px; border-radius:50%;
    background:radial-gradient(circle, rgba(0,0,0,0.96) 66%, transparent 100%);
    border:2px solid var(--neon-soft);
    box-shadow:0 0 50px var(--neon), inset 0 0 40px rgba(0,255,204,0.35);
    transition:transform 0.2s ease-out; z-index:1;
    overflow:visible;
  }

  /* Orbiting Tabs */
  .tab{
    position:absolute; background:rgba(0,255,204,0.08);
    border:1px solid var(--neon-soft);
    padding:10px 18px; border-radius:50px 10px 50px 10px;
    color:var(--neon); text-decoration:none; font-weight:bold;
    text-transform:uppercase; letter-spacing:1.2px;
    transition:background 0.3s, transform 0.3s; cursor:pointer;
    backdrop-filter:blur(3px);
    box-shadow:0 0 16px rgba(0,255,204,0.35);
    user-select:none;
  }
  .tab:hover{ background:rgba(0,255,204,0.28); transform:scale(1.08); }

  /* Moon Canvas (3D) */
  #moonCanvas{
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:320px; height:320px; border-radius:50%;
    z-index:0; filter:drop-shadow(0 0 25px rgba(0,255,204,0.35));
  }
  /* Soft pulsing cyan halo */
  .moon-halo{
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    width:360px; height:360px; border-radius:50%;
    background:radial-gradient(circle, rgba(0,255,204,0.18), transparent 60%);
    z-index:0; animation:haloPulse 4s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes haloPulse{
    0%,100%{ opacity:0.55; }
    50%{ opacity:0.2; }
  }

  /* Center content floats above moon */
  .center-content{
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:310px; height:310px; border-radius:50%;
    padding:22px; text-align:center;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    z-index:2; pointer-events:none;
  }
  .center-content h1{font-size:clamp(1rem,2.4vh,1.35rem); margin:6px 0 8px}
  .center-content p{font-size:clamp(0.72rem,1.9vh,0.95rem); line-height:1.35; margin:0; color:#b7ffee}

  /* Orbit Animation */
  @keyframes orbit {
    from { transform: rotate(0deg) translateX(230px) rotate(0deg); }
    to { transform: rotate(360deg) translateX(230px) rotate(-360deg); }
  }
  .orbit-container {
    position:absolute; top:50%; left:50%;
    width:0; height:0;
  }
  .orbit-container .tab {
    animation: orbit 20s linear infinite;
  }

  /* Chatbot gadget */
  .chatbot-container{
    position:fixed; bottom:20px; left:20px; z-index:10;
    display:flex; flex-direction:column; align-items:center
  }
  .robot-icon{
    width:80px; height:80px; background:rgba(0,255,204,0.08);
    border:2px solid var(--neon); border-radius:50%;
    box-shadow:0 0 25px var(--neon);
    background-image:url('https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Robot_icon.svg/2048px-Robot_icon.svg.png');
    background-size:cover; margin-bottom:10px
  }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<!-- Wheel -->
<div class="wheel" id="wheel">
  <div class="moon-halo"></div>
  <canvas id="moonCanvas"></canvas>

  <!-- Orbiting Tabs -->
  <div class="orbit-container" style="--i:0"><div class="tab" onclick="showHome()">Analytics</div></div>
  <div class="orbit-container" style="--i:1"><div class="tab" onclick="showMessage('Finance panel docking soonâ€¦')">Finance</div></div>
  <div class="orbit-container" style="--i:2"><div class="tab" onclick="showMessage('AI & ML bay warming upâ€¦')">AI & ML</div></div>
  <div class="orbit-container" style="--i:3"><div class="tab" onclick="openOverlay()">Tools</div></div>
  <div class="orbit-container" style="--i:4"><div class="tab" onclick="showMessage('Transmitting CVâ€¦')">CV</div></div>

  <div class="center-content" id="centerContent">
    <h1 id="ccTitle">Khwaja AI</h1>
    <p id="ccText">
      Intergalactic expertise in <b>Business Analytics</b>, <b>Finance</b>, and <b>Artificial Intelligence</b>.<br/>
      Pilot projects that use machine learning for predictive insights and deploy
      futuristic tools for real-time data visualisation. Engage the orbiting tabs
      to access modules and launch the analyzer.
    </p>
  </div>
</div>

<!-- Chatbot -->
<div class="chatbot-container"><div class="robot-icon"></div></div>
<!-- ============================= -->
<!-- ALIEN OVERLAY: KHWAJA AI ANALYZER -->
<!-- ============================= -->
<div id="analyzerOverlay" class="overlay" aria-hidden="true" style="display:none;">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="panelTitle">
    <div class="panel-header">
      <div class="pill"><span>ðŸ›¸</span><span id="panelTitle">Khwaja AI Analyzer</span></div>
      <button class="close-btn" title="Close" onclick="closeOverlay()">âœ•</button>
    </div>

    <div class="panel-body">
      <!-- Controls -->
      <div class="controls">
        <div class="card">
          <h3>1) Upload Datasets (CSV / Excel)</h3>
          <label>Dataset 1</label>
          <input id="file1" type="file" accept=".csv,.xlsx,.xls" />
          <label>Dataset 2</label>
          <input id="file2" type="file" accept=".csv,.xlsx,.xls" />
          <div style="margin-top:8px;font-size:.8rem;color:#b7ffee">Tip: First rows should have headers.</div>
        </div>

        <div class="card">
          <h3>2) Select Columns</h3>
          <div class="row">
            <div>
              <label for="x1">X (Dataset 1)</label>
              <select id="x1" disabled></select>
            </div>
            <div>
              <label for="y1">Y (Dataset 1)</label>
              <select id="y1" disabled></select>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="x2">X (Dataset 2)</label>
              <select id="x2" disabled></select>
            </div>
            <div>
              <label for="y2">Y (Dataset 2)</label>
              <select id="y2" disabled></select>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="chartType">Chart Type</label>
              <select id="chartType" disabled>
                <option value="scatter">Scatter</option>
                <option value="line">Line</option>
                <option value="bar">Bar</option>
                <option value="area">Area</option>
                <option value="histogram">Histogram</option>
                <option value="box">Box</option>
                <option value="pie">Pie</option>
                <option value="heatmap">Heatmap</option>
              </select>
            </div>
            <div>
              <label for="mode">Compare Mode</label>
              <select id="mode" disabled>
                <option value="overlay">Overlay</option>
                <option value="side">Side-by-Side (Bars)</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>3) Render</h3>
          <button id="vizBtn" class="btn" onclick="plotData()" disabled>Visualize â–¶</button>
          <div class="footer-actions" style="margin-top:10px">
            <button class="btn" onclick="downloadChart('png')" disabled id="dlPng">Download PNG</button>
            <button class="btn" onclick="downloadChart('jpeg')" disabled id="dlJpg">Download JPEG</button>
            <button class="btn" onclick="downloadChart('svg')" disabled id="dlSvg">Download SVG</button>
          </div>
        </div>

        <div class="card">
          <h3>Status</h3>
          <div id="status">Awaiting inputâ€¦</div>
        </div>
      </div>

      <!-- Chart Area -->
      <div class="chart-wrap">
        <div id="chart"></div>
      </div>
    </div>
  </div>
</div>

<!-- Stars Background -->
<script>
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [], meteors = [];

function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); addEventListener('resize', resizeCanvas);

function createStars(count){
  stars = [];
  for(let i=0;i<count;i++){
    stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, speed:Math.random()*0.5+0.2, size:Math.random()*2 });
  }
}
function createMeteors(count){
  meteors = [];
  for(let i=0;i<count;i++){
    meteors.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, speedX:-(Math.random()*4+2), speedY:Math.random()*2+1, length:Math.random()*50+30 });
  }
}

function drawStars(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#00ffcc';
  for(const s of stars){
    ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill();
    s.y += s.speed; if(s.y>canvas.height){ s.y=0; s.x=Math.random()*canvas.width; }
  }
  ctx.strokeStyle = '#00ffcc'; ctx.lineWidth = 1.5;
  for(const m of meteors){
    ctx.beginPath(); ctx.moveTo(m.x,m.y);
    ctx.lineTo(m.x + m.length*m.speedX/10, m.y + m.length*m.speedY/10);
    ctx.stroke(); m.x += m.speedX; m.y += m.speedY;
    if(m.x < -100 || m.y > canvas.height+100){ m.x = canvas.width + Math.random()*200; m.y = Math.random()*canvas.height/2; }
  }
}
createStars(220); createMeteors(6);
(function animate(){ drawStars(); requestAnimationFrame(animate); })();
</script>

<!-- Wheel rotation -->
<script>
document.addEventListener('mousemove', e=>{
  const centerX = innerWidth/2;
  const offsetX = e.clientX - centerX;
  const rotation = offsetX/20;
  document.getElementById('wheel').style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
});
</script>

<!-- Center text fit -->
<script>
function fitCenterText(){
  const cc = document.getElementById('centerContent');
  const h1 = document.getElementById('ccTitle');
  const p = document.getElementById('ccText');
  if(!cc || !h1 || !p) return;
  let hSize = parseFloat(getComputedStyle(h1).fontSize);
  let pSize = parseFloat(getComputedStyle(p).fontSize);
  let guard=0;
  while((cc.scrollHeight > cc.clientHeight) && guard<60){
    hSize = Math.max(12, hSize - 0.5);
    pSize = Math.max(10, pSize - 0.5);
    h1.style.fontSize = hSize + 'px';
    p.style.fontSize = pSize + 'px';
    guard++;
  }
}
addEventListener('load', fitCenterText);
addEventListener('resize', ()=>{ setTimeout(fitCenterText, 100); });

function showHome(){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `<h1 id="ccTitle">Khwaja AI</h1><p id="ccText">Intergalactic expertise in <b>Business Analytics</b>, <b>Finance</b>, and <b>Artificial Intelligence</b>.<br/>Pilot projects that use machine learning for predictive insights and deploy futuristic tools for real-time visualisation. Click <b>Tools</b> to launch the analyzer.</p>`;
  fitCenterText();
}
function showMessage(msg){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `<h1 id="ccTitle">Console</h1><p id="ccText">${msg}</p>`;
  fitCenterText();
}
</script>

<!-- Overlay Controls -->
<script>
function openOverlay(){ document.getElementById('analyzerOverlay').style.display = 'grid'; setStatus('Overlay online. Load data to beginâ€¦'); }
function closeOverlay(){ document.getElementById('analyzerOverlay').style.display = 'none'; }
</script>

<!-- Moon (Three.js) -->
<script>
const moonCanvas = document.getElementById('moonCanvas');
const renderer = new THREE.WebGLRenderer({canvas: moonCanvas, alpha: true, antialias:true});
function sizeMoon(){
  renderer.setSize(320, 320, false);
}
sizeMoon(); addEventListener('resize', sizeMoon);
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
camera.position.z = 3.1;

const ambient = new THREE.AmbientLight(0x00ffcc, 0.35);
const point = new THREE.PointLight(0x00ffcc, 1.1);
point.position.set(3, 2, 4);
scene.add(ambient, point);

const loader = new THREE.TextureLoader();
loader.load('https://threejsfundamentals.org/threejs/resources/images/moon.jpg', tex=>{
  tex.colorSpace = THREE.SRGBColorSpace;
  const geo = new THREE.SphereGeometry(1, 64, 64);
  const mat = new THREE.MeshPhongMaterial({ map: tex, shininess: 8 });
  const moon = new THREE.Mesh(geo, mat);
  scene.add(moon);

  function animate(){
    requestAnimationFrame(animate);
    moon.rotation.y += 0.0016;
    renderer.render(scene, camera);
  }
  animate();
});
</script>

<!-- Analyzer Logic -->
<script>
let dataset1 = [], dataset2 = [];
let ds1Label = 'Dataset 1', ds2Label = 'Dataset 2';
const el = id => document.getElementById(id);
const setStatus = msg => el('status').textContent = msg;

function setControlsEnabled(enabled){
  ['x1','y1','x2','y2','chartType','mode','vizBtn','dlPng','dlJpg','dlSvg'].forEach(id=>{
    const e = el(id); if(e){ e.disabled = !enabled; }
  });
}
setControlsEnabled(false);

function wireFileInputs(){
  el('file1').addEventListener('change', e=> loadFile(e.target.files[0], 1));
  el('file2').addEventListener('change', e=> loadFile(e.target.files[0], 2));
}
wireFileInputs();

function loadFile(file, index){
  if(!file){ return; }
  const name = file.name || `dataset${index}`;
  const ext = name.split('.').pop().toLowerCase();
  setStatus(`Loading ${name} â€¦`);
  const assign = data => assignData(data, index, name);

  if(ext === 'csv'){
    Papa.parse(file, { header:true, dynamicTyping:true, skipEmptyLines:true, complete: res => assign(res.data) });
  } else if(ext === 'xlsx' || ext === 'xls'){
    const reader = new FileReader();
    reader.onload = e=>{
      const wb = XLSX.read(new Uint8Array(e.target.result), {type:'array'});
      const sheet = wb.SheetNames[0];
      const json = XLSX.utils.sheet_to_json(wb.Sheets[sheet], {defval:null});
      assign(json);
    };
    reader.readAsArrayBuffer(file);
  } else {
    alert('Unsupported file type.');
    setStatus('Unsupported file type.');
  }
}

function assignData(data, index, label){
  const cleaned = (data||[]).filter(row => Object.values(row).some(v => v!==null && v!=='' && v!==undefined));
  if(index===1){ dataset1 = cleaned; ds1Label = label; } else { dataset2 = cleaned; ds2Label = label; }
  setStatus(`${label} loaded (${cleaned.length} rows).`);
  if(dataset1.length && dataset2.length){ populateDropdowns(); setControlsEnabled(true); }
}

function populateDropdowns(){
  const sample1 = dataset1[0] || {}; const sample2 = dataset2[0] || {};
  const keys1 = Object.keys(sample1); const keys2 = Object.keys(sample2);
  const numeric1 = keys1.filter(k=> isNumericColumn(dataset1, k));
  const numeric2 = keys2.filter(k=> isNumericColumn(dataset2, k));

  fillSelect(el('x1'), keys1);
  fillSelect(el('y1'), numeric1.length?numeric1:keys1);
  fillSelect(el('x2'), keys2);
  fillSelect(el('y2'), numeric2.length?numeric2:keys2);
  setStatus('Columns ready. Choose X/Y and chart type.');
}

function fillSelect(selectEl, items){
  selectEl.innerHTML = '';
  items.forEach(k=>{ const o=document.createElement('option'); o.value=o.textContent=k; selectEl.appendChild(o); });
  selectEl.disabled = items.length === 0;
}

function isNumericColumn(ds, key){
  const vals = ds.slice(0,40).map(r=> r? r[key] : undefined).filter(v=> v!==null && v!=='' && v!==undefined);
  if(!vals.length) return false;
  return vals.every(v=> typeof v === 'number' || (!isNaN(parseFloat(v)) && isFinite(v)));
}

function toNum(v){ return (typeof v === 'number')? v : parseFloat(v); }

function plotData(){
  const x1 = el('x1').value, y1 = el('y1').value;
  const x2 = el('x2').value, y2 = el('y2').value;
  const chartType = el('chartType').value, mode = el('mode').value;

  const trace1 = buildTrace(dataset1, x1, y1, chartType, ds1Label);
  const trace2 = buildTrace(dataset2, x2, y2, chartType, ds2Label);

  let data = [trace1, trace2];
  let layout = baseLayout(chartType, mode);
  if(chartType === 'pie'){
    data = [{...trace1, domain:{row:0,column:0}}, {...trace2, domain:{row:0,column:1}}];
    layout.grid = {rows:1, columns:2};
  }
  if(chartType === 'bar' && mode === 'side'){ layout.barmode = 'group'; }
  if(chartType === 'bar' && mode === 'overlay'){ layout.barmode = 'overlay'; trace1.opacity=0.85; trace2.opacity=0.65; }

  Plotly.newPlot('chart', data, layout, {responsive:true, displaylogo:false}).then(()=>{
    setStatus('Visualization rendered.');
    ['dlPng','dlJpg','dlSvg'].forEach(id=> el(id).disabled=false);
  });
}

function buildTrace(ds, xKey, yKey, type, name){
  const x = ds.map(r=> r[xKey]);
  const y = ds.map(r=> toNum(r[yKey]));
  if(type === 'bar'){ return { type:'bar', x, y, name }; }
  return { type:type==='line'?'scatter':'scatter', mode:type==='line'?'lines':'markers', x, y, name };
}

function baseLayout(type, mode){
  return {
    paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0.55)',
    font:{color:'#a6ffee'},
    xaxis:{gridcolor:'rgba(0,255,204,0.15)'},
    yaxis:{gridcolor:'rgba(0,255,204,0.15)'},
  };
}

function downloadChart(fmt='png'){
  Plotly.downloadImage('chart', {format:fmt, filename:`khwaja_ai_chart_${Date.now()}`});
}
</script>
</body>
</html>
