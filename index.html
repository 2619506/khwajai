<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Khwaja AI | Intelligent Analytics</title>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;700;900&family=Outfit:wght@300;400;600&display=swap');

  :root{
    /* --- NATURAL ROCK PALETTE --- */
    --rock-light: #94a3b8;   /* Sunlit Dust */
    --rock-mid: #475569;     /* Grey Stone */
    --rock-dark: #1e293b;    /* Deep Crevasse */
    --void: #020617;         /* Deep Space */
    --highlight: #e2e8f0;    /* Specular Reflection */
  }

  * { box-sizing:border-box; }
  html, body { height:100%; }
  body {
    margin: 0; overflow: hidden; background: var(--void); 
    color: #fff;
    font-family: 'Outfit', sans-serif;
    letter-spacing: 0.5px;
  }

  /* Starfield */
  canvas#stars { position:fixed; inset:0; z-index:-3; }

  /* --- PLANET SURFACE ENGINE (CSS Procedural) --- */
  .celestial-body {
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    /* Natural Lighting: Top-Left Light Source */
    background: radial-gradient(
      circle at 30% 30%, 
      var(--highlight) 0%, 
      var(--rock-light) 20%, 
      var(--rock-mid) 50%, 
      var(--rock-dark) 80%, 
      #000000 100%
    );
    box-shadow: 
      inset 5px 5px 20px rgba(255,255,255,0.2), 
      inset -10px -10px 50px rgba(0,0,0,0.9),
      0 0 40px rgba(0,0,0,0.8);
    border: 1px solid rgba(255,255,255,0.05);
    transition: transform 0.1s ease-out; /* Smooth movement for parallax */
  }

  /* Craters & Texture */
  .celestial-body::after {
    content: ''; position: absolute; inset: 0; border-radius: 50%;
    background-image: 
      radial-gradient(circle at 25% 75%, rgba(0,0,0,0.15) 2%, transparent 5%),
      radial-gradient(circle at 75% 25%, rgba(0,0,0,0.1) 4%, transparent 8%),
      radial-gradient(circle at 50% 50%, rgba(255,255,255,0.03) 1%, transparent 2%);
    mix-blend-mode: overlay;
    pointer-events: none;
  }

  /* --- MAIN CENTRAL ASTEROID --- */
  .wheel {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
    width: min(65vw, 550px); height: min(65vw, 550px);
    z-index: 1;
  }

  /* --- SATELLITE MOONS (Tabs) --- */
  .moon {
    position: absolute;
    width: 90px; height: 90px;
    z-index: 10;
    cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    color: #fff; font-family: 'Orbitron', sans-serif; font-size: 0.65rem; font-weight: 700;
    text-transform: uppercase; text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,1);
    transition: transform 0.1s ease-out, box-shadow 0.3s; /* Fast transform for mouse reaction */
  }

  .moon:hover {
    box-shadow: 0 0 30px rgba(255,255,255,0.3);
    z-index: 20;
    border-color: rgba(255,255,255,0.4);
  }

  /* --- MOON POSITIONS (Closer to Globe) --- */
  /* Top Left */
  .pos-tl { top: 15%; left: 15%; }
  
  /* Bottom Left */
  .pos-bl { bottom: 15%; left: 15%; }
  
  /* Bottom Right */
  .pos-br { bottom: 15%; right: 15%; }

  /* --- PORTFOLIO PLANET (Isolated Top Right) --- */
  .portfolio-orbit {
    position: fixed; top: 5%; right: 5%;
    width: 110px; height: 110px;
    z-index: 100;
    /* Distinct Blue Ice Look */
    background: radial-gradient(circle at 30% 30%, #e0f2fe 0%, #38bdf8 30%, #0284c7 60%, #082f49 100%);
    box-shadow: inset 5px 5px 20px rgba(255,255,255,0.4), 0 0 30px rgba(56, 189, 248, 0.3);
    animation: floatPlanet 8s ease-in-out infinite;
    cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    color: #fff; font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 0.75rem;
    border-radius: 50%;
  }
  .portfolio-orbit:hover { transform: scale(1.1); box-shadow: 0 0 50px rgba(56, 189, 248, 0.6); }
  @keyframes floatPlanet { 0%,100%{transform:translateY(0)} 50%{transform:translateY(10px)} }

  /* --- CENTER TYPOGRAPHY (Beautified) --- */
  .center-content {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
    width: 75%; height: 75%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    pointer-events: none; text-align: center;
  }

  #ccTitle {
    margin: 0 0 8px 0;
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(2rem, 4.5vw, 3.2rem); 
    font-weight: 900; letter-spacing: 3px;
    text-transform: uppercase;
    /* Silver-Metallic Gradient */
    background: linear-gradient(180deg, #ffffff 10%, #94a3b8 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
  }

  #ccSubtitle {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(0.7rem, 1.2vw, 0.9rem);
    color: #cbd5e1; letter-spacing: 2px;
    text-transform: uppercase; margin-bottom: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px;
  }

  #ccText {
    color: #e2e8f0; font-size: clamp(0.85rem, 1.3vh, 1rem);
    line-height: 1.6; font-weight: 300; 
    text-align: justify; /* Newspaper style edges */
    text-align-last: center; /* Center last line */
    max-width: 480px;
    text-shadow: 0 1px 3px rgba(0,0,0,0.9);
  }

  /* Chatbot Dock */
  .assistant-wrap { position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%); width: 58px; height: 58px; z-index: 9998; pointer-events: none; }
  .assistant-wrap::before { content: ""; position: absolute; inset: 0; border-radius: 50%; background: radial-gradient(circle at center, rgba(255,255,255,0.9) 0%, rgba(139, 169, 219, 0.4) 40%, transparent 100%); box-shadow: 0 0 18px rgba(255,255,255,0.4); filter: blur(2px); animation: assistantGlow 4s ease-in-out infinite alternate; z-index: -1; }
  @keyframes assistantGlow { from { opacity: 0.65; transform: scale(0.95); } to { opacity: 1; transform: scale(1.05); } }

  /* OVERLAY & TOOLS */
  .overlay { position: fixed; inset: 0; display: none; place-items: center; z-index: 500; background: radial-gradient(ellipse at center, rgba(15, 23, 42, 0.9) 0%, rgba(2, 6, 23, 0.98) 80%); animation: fadeIn 300ms ease-out; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .panel { width: min(1200px, 92vw); height: min(78vh, 820px); border: 1px solid rgba(255,255,255,0.1); background: linear-gradient(180deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98)); border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.8); backdrop-filter: blur(15px); position: relative; overflow: hidden; }
  .panel-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); }
  .close-btn { width: 36px; height: 36px; border-radius: 50%; border: 1px solid #fff; background: transparent; color: #fff; cursor: pointer; display: grid; place-items: center; }
  .panel-body { display: grid; grid-template-columns: 320px 1fr; gap: 16px; height: calc(100% - 62px); padding: 16px; }
  .controls { overflow-y: auto; } .chart-wrap { position: relative; height: 100%; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 8px; background: rgba(0,0,0,0.3); }
  .card { border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 12px; margin-bottom: 12px; background: rgba(255,255,255,0.03); }
  input, select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.5); color: #fff; }
  .btn { cursor: pointer; font-weight: bold; text-transform: uppercase; } .btn:hover { background: rgba(255,255,255,0.1); }
  #sphereWrap { position: absolute; inset: 8px; border-radius: 12px; overflow: hidden; z-index: 0; pointer-events: none; }
  canvas#sphere { width: 100%; height: 100%; display: block; filter: drop-shadow(0 0 10px var(--neon)); opacity: 0.6; }
  .insights { position: absolute; left: 16px; right: 16px; bottom: 16px; z-index: 2; background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 10px; color: var(--ink); font-size: 0.85rem; }

  @media (max-width: 980px){ 
    .panel-body { grid-template-columns: 1fr; height: auto; } .chart-wrap { height: 50vh; } #sphereWrap { display: none; }
    .moon { width: 75px; height: 75px; font-size: 0.55rem; }
    .pos-tl { top: 5%; left: 5%; }
    .pos-bl { bottom: 15%; left: 5%; }
    .pos-br { bottom: 15%; right: 5%; }
    .portfolio-orbit { top: 5%; right: 5%; width: 75px; height: 75px; font-size: 0.55rem; }
    .wheel { width: 85vw; height: 85vw; }
  }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<div class="wheel celestial-body" id="wheel">
  
  <div class="center-content" id="centerContent">
    <h1 id="ccTitle">KHWAJA GHAFOORI</h1>
    <div id="ccSubtitle">Financial AI & Business Intelligence</div>
    <p id="ccText">
      Merging an MSc in Business Analytics & Finance with over 5 years of operational expertise. From streamlining diplomatic workflows to driving data-led strategies in retail, I bridge the gap between technical insights and executive decision-making. I specialize in optimizing processes, financial modeling, and delivering actionable intelligence using Python, SQL, and Power BI.
    </p>
  </div>
</div>

<div class="moon celestial-body pos-tl parallax-moon" data-speed="2" onclick="showProjects()">Projects</div>
<div class="moon celestial-body pos-bl parallax-moon" data-speed="3" onclick="openOverlay()">Tools</div>
<div class="moon celestial-body pos-br parallax-moon" data-speed="2" onclick="showAIML()">AI & ML</div>

<div class="portfolio-orbit" onclick="window.open('/portfolio/', '_blank')">Portfolio</div>

<div class="assistant-wrap"><div class="assistant-hole"></div></div>

<div id="analyzerOverlay" class="overlay" aria-hidden="true">
  <div class="panel" role="dialog">
    <div class="panel-header">
      <div style="display:flex;align-items:center;gap:10px"><span>üõ∏</span><span style="font-weight:bold;letter-spacing:1px">Khwaja AI Analyzer</span></div>
      <button class="close-btn" onclick="closeOverlay()">‚úï</button>
    </div>
    <div class="panel-body">
      <div class="controls">
        <div class="card"><h3>1. Data Upload</h3><label>Dataset 1</label><input id="file1" type="file" accept=".csv,.xlsx"><label>Dataset 2</label><input id="file2" type="file" accept=".csv,.xlsx"></div>
        <div class="card"><h3>2. Config</h3><label>X</label><select id="x1" disabled></select><label>Y</label><select id="y1" disabled></select><label>Type</label><select id="chartType" disabled><option>scatter</option><option>line</option><option>bar</option><option>heatmap</option></select></div>
        <div class="card"><h3>3. Render</h3><button id="vizBtn" class="btn" onclick="plotData()" disabled>Visualize</button></div>
        <div class="card">Status: <span id="status">Waiting...</span></div>
      </div>
      <div class="chart-wrap"><div id="sphereWrap"><canvas id="sphere"></canvas></div><div id="chart"></div><div id="insights" class="insights" style="display:none"></div></div>
    </div>
  </div>
</div>

<script>
// --- PARALLAX MOUSE EFFECT ---
document.addEventListener('mousemove', (e) => {
  const x = (window.innerWidth - e.pageX * 2) / 100;
  const y = (window.innerHeight - e.pageY * 2) / 100;
  
  // Move the Main Globe (Slowly)
  const wheel = document.getElementById('wheel');
  wheel.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;

  // Move the Satellite Moons (Faster)
  document.querySelectorAll('.parallax-moon').forEach(moon => {
    const speed = moon.getAttribute('data-speed');
    const xShift = x * speed;
    const yShift = y * speed;
    moon.style.transform = `translate(${xShift}px, ${yShift}px)`;
  });
});

// --- CONTENT LOGIC ---
function showProjects(){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `
    <h1 id="ccTitle" style="font-size:2.2rem">KEY PROJECTS</h1>
    <div id="ccText" style="text-align:left; font-size:0.9rem;">
      <ul style="list-style-type:none; padding:0;">
        <li style="margin-bottom:12px;"><b>üõçÔ∏è iOutlet Revenue Analysis</b><br>Analyzed 32,000+ transactions (¬£8.9M) to identify seasonal trends using Python dashboards.</li>
        <li style="margin-bottom:12px;"><b>üçÑ Sustainable Production (AREA)</b><br>Managed ¬£80k donor-funded project, streamlining reporting workflows by 50%.</li>
        <li><b>üìà Financial Forecasting</b><br>Developed equity price models (MATLAB & R) improving predictive accuracy via back-testing.</li>
      </ul>
    </div>
  `;
}

function showAIML(){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `
    <h1 id="ccTitle" style="font-size:2.2rem">AI & ML CORE</h1>
    <div id="ccText" style="text-align:left;">
      <div style="margin-bottom:15px"><b>Technical Arsenal</b><br>Python (Pandas, Scikit-Learn), R, Financial Modelling.</div>
      <b>Capabilities</b>
      <ul style="padding-left:15px; margin-top:5px;">
        <li>Financial Forecasting (ARIMA)</li>
        <li>Purchasing Behavior Modeling</li>
        <li>Regression Analysis & KPIs</li>
        <li>Automated Streamlit Dashboards</li>
      </ul>
    </div>
  `;
}

function showHome(){
  const cc = document.getElementById('centerContent');
  cc.innerHTML = `<h1 id="ccTitle">KHWAJA GHAFOORI</h1><div id="ccSubtitle">Financial AI & Business Intelligence</div><p id="ccText">Merging an MSc in Business Analytics & Finance with over 5 years of operational expertise. From streamlining diplomatic workflows to driving data-led strategies in retail, I bridge the gap between technical insights and executive decision-making. I specialize in optimizing processes, financial modeling, and delivering actionable intelligence using Python, SQL, and Power BI.</p>`;
}

// Reset to home when clicking main globe background (not text)
document.getElementById('wheel').addEventListener('click', (e) => {
  if(e.target === document.getElementById('wheel')) showHome();
});

// --- STANDARD LOGIC (Chatbase, Stars, Overlay) ---
function openOverlay(){ document.getElementById('analyzerOverlay').style.display = 'grid'; startSphere(); onResizeSphere(); }
function closeOverlay(){ document.getElementById('analyzerOverlay').style.display = 'none'; stopSphere(); }

// Chatbase
(function(){
  if(!window.chatbase || window.chatbase("getState")!=="initialized"){
    window.chatbase=(...arguments)=>{ if(!window.chatbase.q){window.chatbase.q=[]} window.chatbase.q.push(arguments) };
    window.chatbase=new Proxy(window.chatbase,{ get(target,prop){ if(prop==="q"){return target.q} return(...args)=>target(prop,...args) } });
  }
  const onLoad=function(){
    const script=document.createElement("script");
    script.src="https://www.chatbase.co/embed.min.js";
    script.id="85-fKKKuG65obFx8ejTz3";
    script.domain="www.chatbase.co";
    document.body.appendChild(script);
  };
  if(document.readyState==="complete"){onLoad()} else { window.addEventListener("load", onLoad) }
})();
window.addEventListener("load", function(){
  setTimeout(()=>{
    const bubble = document.querySelector("#chatbase-bubble, iframe[src*='chatbase']");
    if(bubble){
      bubble.style.position = "absolute"; bubble.style.bottom = "50%"; bubble.style.left = "50%";
      bubble.style.transform = "translate(-50%, 50%) scale(0.9)"; bubble.style.zIndex = "12";
      document.querySelector(".assistant-wrap").appendChild(bubble);
    }
  }, 2500);
});

// Starfield
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [];
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); addEventListener('resize', resizeCanvas);
function createStars(count){ stars=[]; for(let i=0;i<count;i++){ stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, speed:Math.random()*0.2+0.05, size:Math.random()*1.5 }); } }
function drawStars(){ 
  ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#ffffff'; 
  for(const s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill(); s.y+=s.speed; if(s.y>canvas.height){s.y=0;s.x=Math.random()*canvas.width;} } 
  requestAnimationFrame(drawStars);
}
createStars(300); drawStars();

// 3D Sphere (Overlay)
let sphereScene, sphereCamera, sphereRenderer, sphereMesh, sphereReq;
function startSphere(){
  const wrap = document.getElementById('sphereWrap');
  const canvas = document.getElementById('sphere');
  sphereScene = new THREE.Scene();
  const w = wrap.clientWidth, h = wrap.clientHeight;
  sphereCamera = new THREE.PerspectiveCamera(35, w/h, 0.1, 1000); sphereCamera.position.z = 6;
  sphereRenderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
  sphereRenderer.setSize(w,h,false);
  const geo = new THREE.SphereGeometry(2.2, 48, 48);
  const mat = new THREE.MeshPhongMaterial({ color: 0x94a3b8, emissive: 0x0f172a, shininess: 30, transparent:true, opacity:0.6, wireframe:true });
  sphereMesh = new THREE.Mesh(geo, mat); sphereScene.add(sphereMesh);
  const glow = new THREE.PointLight(0xffffff, 1, 50); glow.position.set(4,4,6); sphereScene.add(glow);
  const animate = ()=>{ sphereMesh.rotation.y += 0.0025; sphereRenderer.render(sphereScene, sphereCamera); sphereReq = requestAnimationFrame(animate); };
  animate();
}
function stopSphere(){ if(sphereReq) cancelAnimationFrame(sphereReq); }
function onResizeSphere(){ if(sphereRenderer) { const w = el('sphereWrap').clientWidth, h = el('sphereWrap').clientHeight; sphereRenderer.setSize(w,h,false); sphereCamera.aspect=w/h; sphereCamera.updateProjectionMatrix(); } }
addEventListener('resize', onResizeSphere);

// Chart Logic (Placeholder)
let dataset1 = [], dataset2 = [];
const el = id => document.getElementById(id);
const setStatus = msg => el('status').textContent = msg;
el('file1').addEventListener('change', e=> loadFile(e.target.files[0], 1));
el('file2').addEventListener('change', e=> loadFile(e.target.files[0], 2));
function loadFile(file, idx){ 
  if(!file) return; 
  setStatus(`Loading ${file.name}...`);
  if(file.name.endsWith('.csv')){ Papa.parse(file, {header:true, dynamicTyping:true, complete: res => assignData(res.data, idx)}); }
}
function assignData(data, idx){ 
  const clean = data.filter(r => Object.values(r).some(v=>v!==null));
  if(idx===1) dataset1=clean; else dataset2=clean;
  setStatus(`Loaded dataset ${idx}`);
  if(dataset1.length || dataset2.length) { 
    ['x1','y1','chartType','vizBtn'].forEach(id=> el(id).disabled=false);
    const keys = Object.keys(dataset1[0] || dataset2[0] || {});
    ['x1','y1'].forEach(id => { el(id).innerHTML = keys.map(k=>`<option>${k}</option>`).join(''); });
  }
}
function plotData(){
  const xKey = el('x1').value, yKey = el('y1').value, type = el('chartType').value;
  const trace1 = { x: dataset1.map(r=>r[xKey]), y: dataset1.map(r=>r[yKey]), type: type==='scatter'?'scatter':type, mode:'markers' };
  Plotly.newPlot('chart', [trace1], { paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)', font:{color:'#fff'} });
}
</script>

</body>
</html>
